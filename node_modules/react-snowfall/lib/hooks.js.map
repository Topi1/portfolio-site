{"version":3,"file":"hooks.js","names":["createSnowflakes","canvasRef","amount","config","current","snowflakes","i","push","Snowflake","useSnowflakes","useState","setSnowflakes","useEffect","sizeDifference","length","slice","map","snowflake","updateConfig","useComponentSize","ref","getSize","size","setSize","resizeHandler","useCallback","useLayoutEffect","window","ResizeObserver","resizeObserver","observe","disconnect","addEventListener","removeEventListener","useSnowfallStyle","overrides","styles","useMemo","snowfallBaseStyle","useDeepCompareEffect","effect","deps","useRef","isEqual","useDeepMemo","value","state","setState"],"sources":["../src/hooks.ts"],"sourcesContent":["import { useCallback, useLayoutEffect, useEffect, useRef, useState, useMemo } from 'react'\r\nimport isEqual from 'react-fast-compare'\r\nimport Snowflake, { SnowflakeConfig } from './Snowflake'\r\nimport { snowfallBaseStyle } from './config'\r\nimport { getSize } from './utils'\r\n\r\n/**\r\n * A utility function to create a collection of snowflakes\r\n * @param canvasRef A ref to the canvas element\r\n * @param amount The number of snowflakes\r\n * @param config The configuration for each snowflake\r\n */\r\nconst createSnowflakes = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  amount: number,\r\n  config: SnowflakeConfig,\r\n): Snowflake[] => {\r\n  if (!canvasRef.current) return []\r\n\r\n  const snowflakes: Snowflake[] = []\r\n\r\n  for (let i = 0; i < amount; i++) {\r\n    snowflakes.push(new Snowflake(canvasRef.current, config))\r\n  }\r\n\r\n  return snowflakes\r\n}\r\n\r\n/**\r\n * A utility hook to manage creating and updating a collection of snowflakes\r\n * @param canvasRef A ref to the canvas element\r\n * @param amount The number of snowflakes\r\n * @param config The configuration for each snowflake\r\n */\r\nexport const useSnowflakes = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  amount: number,\r\n  config: SnowflakeConfig,\r\n) => {\r\n  const [snowflakes, setSnowflakes] = useState<Snowflake[]>([])\r\n\r\n  // Handle change of amount\r\n  useEffect(() => {\r\n    setSnowflakes((snowflakes) => {\r\n      const sizeDifference = amount - snowflakes.length\r\n\r\n      if (sizeDifference > 0) {\r\n        return [...snowflakes, ...createSnowflakes(canvasRef, sizeDifference, config)]\r\n      }\r\n\r\n      if (sizeDifference < 0) {\r\n        return snowflakes.slice(0, amount)\r\n      }\r\n\r\n      return snowflakes\r\n    })\r\n  }, [amount, canvasRef, config])\r\n\r\n  // Handle change of config\r\n  useEffect(() => {\r\n    setSnowflakes((snowflakes) =>\r\n      snowflakes.map((snowflake) => {\r\n        snowflake.updateConfig(config)\r\n        return snowflake\r\n      }),\r\n    )\r\n  }, [config])\r\n\r\n  return snowflakes\r\n}\r\n\r\n/**\r\n * Returns the height and width of a HTML element, uses the `ResizeObserver` api if available to detect changes to the\r\n * size. Falls back to listening for resize events on the window.\r\n * @param ref A ref to the HTML element to be measured\r\n */\r\nexport const useComponentSize = (ref: React.RefObject<HTMLElement>) => {\r\n  const [size, setSize] = useState(getSize(ref.current))\r\n\r\n  const resizeHandler = useCallback(() => {\r\n    if (ref.current) {\r\n      setSize(getSize(ref.current))\r\n    }\r\n  }, [ref])\r\n\r\n  useLayoutEffect(() => {\r\n    const { ResizeObserver } = window\r\n\r\n    if (!ref.current) return\r\n    resizeHandler()\r\n\r\n    if (typeof ResizeObserver === 'function') {\r\n      const resizeObserver = new ResizeObserver(resizeHandler)\r\n      resizeObserver.observe(ref.current)\r\n\r\n      return () => resizeObserver.disconnect()\r\n    } else {\r\n      window.addEventListener('resize', resizeHandler)\r\n\r\n      return () => window.removeEventListener('resize', resizeHandler)\r\n    }\r\n  }, [ref, resizeHandler])\r\n\r\n  return size\r\n}\r\n\r\n/**\r\n * Utility hook that merges any provided styles with the default styles\r\n * @param overrides The style prop passed into the component\r\n */\r\nexport const useSnowfallStyle = (overrides?: React.CSSProperties): React.CSSProperties => {\r\n  const styles = useMemo(\r\n    () => ({\r\n      ...snowfallBaseStyle,\r\n      ...(overrides || {}),\r\n    }),\r\n    [overrides],\r\n  )\r\n\r\n  return styles\r\n}\r\n\r\n/**\r\n * Same as `React.useEffect` but uses a deep comparison on the dependency array. This should only\r\n * be used when working with non-primitive dependencies.\r\n *\r\n * @param effect Effect callback to run\r\n * @param deps Effect dependencies\r\n */\r\nexport function useDeepCompareEffect(effect: React.EffectCallback, deps: React.DependencyList) {\r\n  const ref = useRef<React.DependencyList>(deps)\r\n\r\n  // Only update the current dependencies if they are not deep equal\r\n  if (!isEqual(deps, ref.current)) {\r\n    ref.current = deps\r\n  }\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  return useEffect(effect, ref.current)\r\n}\r\n\r\n/**\r\n * Utility hook to stabilize a reference to a value, the returned value will always match the input value\r\n * but (unlike an inline object) will maintain [SameValueZero](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\r\n * equality until a change is made.\r\n *\r\n * @example\r\n *\r\n * const obj = useDeepMemo({ foo: 'bar', bar: 'baz' }) // <- inline object creation\r\n * const prevValue = usePrevious(obj) // <- value from the previous render\r\n * console.log(obj === prevValue) // <- always logs true until value changes\r\n */\r\nexport function useDeepMemo<T>(value: T): T {\r\n  const [state, setState] = useState(value)\r\n\r\n  useDeepCompareEffect(() => setState(value), [value])\r\n\r\n  return state\r\n}\r\n"],"mappings":"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"}